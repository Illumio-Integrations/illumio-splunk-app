<form version="1.1" script="multiselect_input.js">
  <label>Change Monitoring</label>
  <fieldset submitButton="false">
    <input type="time" token="time_range">
      <label>Time Range</label>
      <default>
        <earliest>-7d@h</earliest>
        <latest>now</latest>
      </default>
      <change>
        <eval token="time.earliest_epoch">if(isnum('earliest'),'earliest',relative_time(now(),'earliest')</eval>
        <eval token="time.latest_epoch">if(isnum('latest'),'latest',relative_time(now(),'latest')</eval>
      </change>
    </input>
    <input depends="$supercluster$" type="dropdown" token="is_supercluster" searchWhenChanged="true">
      <label>Supercluster Leader</label>
      <fieldForLabel>leader_fqdn</fieldForLabel>
      <fieldForValue>leader_fqdn</fieldForValue>
      <search>
        <query>| inputlookup illumio_host_details_lookup | dedup leader_fqdn | table leader_fqdn</query>
        <earliest>1</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">Not Configured</choice>
      <prefix>( leader_fqdn="</prefix>
      <suffix>" )</suffix>
      <change>
        <condition label="Not Configured">
          <set token="leader_fqdn"></set>
          <set token="form.fqdn">*</set>
        </condition>
        <condition>
          <set token="leader_fqdn">$is_supercluster$</set>
          <set token="form.fqdn">*</set>
        </condition>
      </change>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="multiselect" token="fqdn" searchWhenChanged="true">
      <label>PCE</label>
      <choice value="*">All</choice>
      <default>*</default>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <initialValue>*</initialValue>
      <valuePrefix>pce="</valuePrefix>
      <valueSuffix>"</valueSuffix>
      <delimiter> OR </delimiter>
      <fieldForLabel>fqdn</fieldForLabel>
      <fieldForValue>fqdn</fieldForValue>
      <search>
        <query>| inputlookup illumio_host_details_lookup 
| fillnull value="-" leader_fqdn 
| search $leader_fqdn$
| dedup fqdn 
| table fqdn</query>
        <earliest>$time_range.earliest$</earliest>
        <latest>$time_range.latest$</latest>
      </search>
    </input>
  </fieldset>
  <row depends="$hidden$">
    <panel>
      <table>
        <search>
          <done>
            <condition match="$result.count$&gt;0">
              <set token="supercluster"></set>
              <set token="leader_fqdn"></set>
            </condition>
            <condition>
              <unset token="supercluster"></unset>
              <set token="leader_fqdn"></set>
            </condition>
          </done>
          <query>| inputlookup illumio_host_details_lookup | stats count by leader_fqdn</query>
          <earliest>1</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>Daily Changes</title>
      <single>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") | dedup json_data | mvexpand change_type | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$ | timechart span=1d count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="refresh.display">progressbar</option>
        <option name="useColors">0</option>
        <drilldown>
          <eval token="e_time">relative_time($latest$,"-1d@d")</eval>
          <eval token="earliest_time">if(strftime($time.earliest_epoch$,"%d")==strftime($time.latest_epoch$,"%d"),$time_range.earliest$,$e_time$)</eval>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20%7C%20dedup%20json_data%20%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20search%20actual_user%3D%22*%22%20$leader_fqdn$%20$fqdn$&amp;earliest=$earliest_time$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Daily Creates</title>
      <single>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") | dedup json_data | mvexpand change_type | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$ change_type="create" | timechart span=1d count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <eval token="e_time">relative_time($latest$,"-1d@d")</eval>
          <eval token="earliest_time">if(strftime($time.earliest_epoch$,"%d")==strftime($time.latest_epoch$,"%d"),$time_range.earliest$,$e_time$)</eval>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20change_type%3D%22create%22%20%7C%20dedup%20json_data%20%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20search%20actual_user%3D%22*%22%20$leader_fqdn$%20$fqdn$&amp;earliest=$earliest_time$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Daily Updates</title>
      <single>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") | dedup json_data | mvexpand change_type | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$ change_type="update" | timechart span=1d count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <eval token="e_time">relative_time($latest$,"-1d@d")</eval>
          <eval token="earliest_time">if(strftime($time.earliest_epoch$,"%d")==strftime($time.latest_epoch$,"%d"),$time_range.earliest$,$e_time$)</eval>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20change_type%3D%22update%22%20%7C%20dedup%20json_data%20%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20search%20actual_user%3D%22*%22%20$leader_fqdn$%20$fqdn$&amp;earliest=$earliest_time$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </single>
    </panel>
    <panel>
      <title>Daily Deletes</title>
      <single>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") | dedup json_data | mvexpand change_type | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$ change_type="delete" | timechart span=1d count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">all</option>
        <option name="numberPrecision">0</option>
        <option name="refresh.display">progressbar</option>
        <option name="showSparkline">1</option>
        <option name="showTrendIndicator">1</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
        <option name="trendColorInterpretation">standard</option>
        <option name="trendDisplayMode">absolute</option>
        <option name="unitPosition">after</option>
        <option name="useColors">0</option>
        <option name="useThousandSeparators">1</option>
        <drilldown>
          <eval token="e_time">relative_time($latest$,"-1d@d")</eval>
          <eval token="earliest_time">if(strftime($time.earliest_epoch$,"%d")==strftime($time.latest_epoch$,"%d"),$time_range.earliest$,$e_time$)</eval>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20change_type%3D%22delete%22%20%7C%20dedup%20json_data%20%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20search%20actual_user%3D%22*%22%20$leader_fqdn$%20$fqdn$&amp;earliest=$earliest_time$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </single>
    </panel>
  </row>
  <row>
    <panel>
      <title>Changes by Object</title>
      <table>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete")  | dedup json_data | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$  | rex field=event_type "^(?&lt;object_type&gt;[a-zA-z]+\b)" | stats count as Count by object_type | rename object_type AS "Object Type" | sort - Count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20%20%7C%20dedup%20json_data%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20rex%20field%3Devent_type%20%22%5E(%3F%3Cobject_type%3E%5Ba-zA-z%5D%2B%5Cb)%22%20%7C%20search%20actual_user%3D%22*%22%20$leader_fqdn$%20$fqdn$%20object_type%3D%22$click.value$%22&amp;earliest=$time_range.earliest$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </table>
    </panel>
    <panel>
      <title>Changes by User</title>
      <table>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") | dedup json_data | spath input=json_data output=pce path=pce_fqdn |  spath input=json_data output=actual_user path=created_by.user.username | search actual_user="*" $leader_fqdn$ $fqdn$ | stats count as Count by actual_user | rename actual_user AS "Actual User" | sort - Count</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="drilldown">row</option>
        <drilldown>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20%7C%20dedup%20json_data%20%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%7C%20%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%7C%20search%20$leader_fqdn$%20$fqdn$%20actual_user%3D%22$click.value$%22&amp;earliest=$time_range.earliest$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <title>All Change Events</title>
      <table>
        <search>
          <query>`illumio_get_index` sourcetype="illumio:pce" (NOT "system_events") (event_type="*.create" OR event_type="*.update" OR event_type="*.delete") 
| dedup json_data 
| spath input=json_data output=pce path=pce_fqdn 
| spath input=json_data output=actual_user path=created_by.user.username 
| search actual_user="*" $leader_fqdn$ $fqdn$ 
| rex field=event_type "^(?&lt;object_type&gt;[a-zA-z]+\b)" 
| spath input=json_data output=resource_url path=resource_changes{0}
| eval resource_href=spath(resource_url, "resource."+object_type+".href")
| spath input=json_data output=resource_changes path=resource_changes{} 
| mvexpand resource_changes
| spath input=resource_changes output=change_details path=changes 
| spath input=resource_changes output=change_type path=change_type
| fillnull value="-" 
| table timestamp, actual_user, src_ip, pce, object_type, change_type, resource_href, change_details 
| rename timestamp as Timestamp actual_user as "Actual User" src_ip as "Source IP" pce as "PCE" object_type as "Object Type" change_type as "Change Type" resource_href as "Resource Href" change_details as "Change Details" 
| eval Timestamp=strptime('Timestamp',"%Y-%m-%dT%H:%M:%S") 
| fieldformat "Timestamp"=strftime('Timestamp',"%+") 
| sort - Timestamp</query>
          <earliest>$time_range.earliest$</earliest>
          <latest>$time_range.latest$</latest>
          <sampleRatio>1</sampleRatio>
          <refresh>10m</refresh>
          <refreshType>delay</refreshType>
        </search>
        <option name="count">20</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">row</option>
        <option name="percentagesRow">false</option>
        <option name="rowNumbers">false</option>
        <option name="totalsRow">false</option>
        <option name="wrap">true</option>
        <drilldown>
          <link target="_blank">search?q=%60illumio_get_index%60%20sourcetype%3D%22illumio%3Apce%22%20(NOT%20%22system_events%22)%20(event_type%3D%22*.create%22%20OR%20event_type%3D%22*.update%22%20OR%20event_type%3D%22*.delete%22)%20%0D%0A%7C%20dedup%20json_data%20%0D%0A%7C%20spath%20input%3Djson_data%20output%3Dpce%20path%3Dpce_fqdn%20%0D%0A%7C%20spath%20input%3Djson_data%20output%3Dactual_user%20path%3Dcreated_by.user.username%20%0D%0A%7C%20rex%20field%3Devent_type%20%22%5E(%3F%3Cobject_type%3E%5Ba-zA-z%5D%2B%5Cb)%22%20%0D%0A%7C%20spath%20input%3Djson_data%20output%3Dresource_url%20path%3Dresource_changes%7B0%7D%0D%0A%7C%20eval%20resource_href%3Dspath(resource_url%2C%20%22resource.%22%2Bobject_type%2B%22.href%22)%0D%0A%7C%20spath%20input%3Djson_data%20output%3Dresource_changes%20path%3Dresource_changes%7B%7D%20%0D%0A%7C%20mvexpand%20resource_changes%0D%0A%7C%20spath%20input%3Dresource_changes%20output%3Dchange_details%20path%3Dchanges%20%0D%0A%7C%20spath%20input%3Dresource_changes%20output%3Dchange_type%20path%3Dchange_type%20%0D%0A%7C%20fillnull%20value%3D%22-%22%20%0D%0A%7C%20search%20actual_user%3D%22$row.Actual User$%22%20src_ip%3D%22$row.Source IP$%22%20pce%3D%22$row.PCE$%22%20object_type%3D%22$row.Object Type$%22%20change_type%3D%22$row.Change Type$%22%20resource_href%3D%22$row.Resource Href$%22%20change_details%3D$row.Change Details|s$%0D%0A%7C%20eval%20timestamp%3Dstrptime('timestamp'%2C%22%25Y-%25m-%25dT%25H%3A%25M%3A%25S%22)%20%0D%0A%7C%20eval%20time%3Dstrptime(%22$row.Timestamp$%22%2C%22%25a%20%25B%20%25d%20%25H%3A%25M%3A%25S%20%25Z%20%25Y%22)%0D%0A%7C%20where%20timestamp%3Dtime&amp;earliest=$time_range.earliest$&amp;latest=$time_range.latest$</link>
        </drilldown>
      </table>
    </panel>
  </row>
</form>