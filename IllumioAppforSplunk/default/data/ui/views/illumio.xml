<form version="1.1" script="illumio.js,multiselect_input.js">
  <label>Security Operations</label>
  <fieldset submitButton="false">
    <input depends="$supercluster$" type="dropdown" token="is_supercluster" searchWhenChanged="true">
      <label>Supercluster Leader</label>
      <fieldForLabel>leader_fqdn</fieldForLabel>
      <fieldForValue>leader_fqdn</fieldForValue>
      <search>
        <query>| inputlookup illumio_host_details_lookup | dedup leader_fqdn | table leader_fqdn</query>
        <earliest>1</earliest>
        <latest>now</latest>
      </search>
      <choice value="*">Not Configured</choice>
      <change>
        <condition label="Not Configured">
          <set token="leader_fqdn"></set>
          <set token="tstats_leader_fqdn"></set>
          <set token="form.fqdn_form">*</set>
        </condition>
        <condition>
          <set token="leader_fqdn">( leader_fqdn="$is_supercluster$" )</set>
          <set token="tstats_leader_fqdn">( Illumio.leader_fqdn="$is_supercluster$" )</set>
          <set token="form.fqdn_form">*</set>
        </condition>
      </change>
      <default>*</default>
      <initialValue>*</initialValue>
    </input>
    <input type="multiselect" token="fqdn_form" id="fqdn_id">
      <label>PCE</label>
      <choice value="*">All</choice>
      <search>
        <query>| inputlookup illumio_host_details_lookup 
| fillnull value="-" leader_fqdn 
| search $leader_fqdn$
| dedup fqdn 
| table fqdn</query>
        <earliest>1</earliest>
        <latest>now</latest>
      </search>
      <default>*</default>
      <delimiter> OR </delimiter>
      <fieldForLabel>fqdn</fieldForLabel>
      <fieldForValue>fqdn</fieldForValue>
      <initialValue>*</initialValue>
      <prefix>(</prefix>
      <suffix>)</suffix>
      <valuePrefix>pce_fqdn="</valuePrefix>
      <valueSuffix>"</valueSuffix>
    </input>
  </fieldset>
  <row depends="$hidden$">
    <panel>
      <table>
        <search>
          <done>
            <condition match="$result.count$&gt;0">
              <set token="supercluster"></set>
              <set token="leader_fqdn"></set>
              <set token="tstats_leader_fqdn"></set>
            </condition>
            <condition>
              <unset token="supercluster"></unset>
              <set token="leader_fqdn"></set>
              <set token="tstats_leader_fqdn"></set>
            </condition>
          </done>
          <query>| inputlookup illumio_host_details_lookup | stats count by leader_fqdn</query>
          <earliest>1</earliest>
          <latest>now</latest>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
      </table>
    </panel>
  </row>
  <row>
    <panel id="audit_event">
      <title>Audit Event In Last 60 minutes</title>
      <single>
        <search>
          <query>| savedsearch Illumio_Auditable_Events | search $leader_fqdn$ $fqdn$ | eval _time=_time-now()%3600 | timechart count as count span=60m | tail 25 | tail 24 | eval _time=_time+now()%3600 | append [| stats count ] | fillnull _time | head 24</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <drilldown>
          <link target="_blank">search?q=| savedsearch Illumio_Auditable_Events | search $leader_fqdn$ $fqdn$ | rename event_type as "Event Type" | stats count as "Count" by "Event Type" | sort 0 -Count&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel id="ports_scan">
      <title>Ports Scan In Last 60 minutes</title>
      <single>
        <search>
          <query>`illumio_portscan_index` search_name="Illumio_PortScan" | rename orig_host as host, fqdn as pce_fqdn | search $leader_fqdn$ $fqdn$ | eval _time=_time-now()%3600 | timechart sum(count) as count span=60m | tail 25 | tail 24 | eval _time=_time+now()%3600 | append [| stats count ] | fillnull _time | head 24</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <drilldown>
          <link target="_blank">port_scan?leader_fqdn=$leader_fqdn$&amp;fqdn=$fqdn$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="trendDisplayMode">percent</option>
        <option name="useColors">1</option>
        <option name="rangeColors">["0x555","0xd93f3c"]</option>
        <option name="rangeValues">[0]</option>
      </single>
    </panel>
    <panel id="firewall_tampering">
      <title>Firewall Tampering In Last 60 minutes</title>
      <single>
        <search>
          <query>| savedsearch Illumio_Firewall_Tempering | search $leader_fqdn$ $fqdn$ | eval _time=_time-now()%3600 | timechart dc(created_hostname) as count span=60m | tail 25 | tail 24 | eval _time=_time+now()%3600 | append [| stats count ] | fillnull _time | head 24</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <drilldown>
          <link target="_blank">firewall_tempering_host?leader_fqdn=$leader_fqdn$&amp;fqdn=$fqdn$&amp;earliest=$earliest$&amp;latest=$latest$</link>
        </drilldown>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="useColors">1</option>
      </single>
    </panel>
    <panel id="overall_traffic_flows">
      <title>Overall Traffic Flows In Last 60 minutes</title>
      <single>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as collector_count from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector (Illumio.pce_fqdn="*") $tstats_leader_fqdn$ Illumio.action="*" by _time span=1ms  | eval _time=_time-now()%3600 | timechart span=60m sum(collector_count) as count | tail 25 | tail 24 | eval _time=_time+now()%3600 | append [| stats count ] | fillnull _time | head 24</query>
          <earliest>-24h</earliest>
          <latest>now</latest>
        </search>
        <option name="colorBy">trend</option>
        <option name="colorMode">none</option>
        <option name="trendColorInterpretation">inverse</option>
        <option name="trendDisplayMode">percent</option>
        <option name="useColors">1</option>
      </single>
    </panel>
  </row>
  <row>
    <panel id="filters_panel">
      <html>
        <style>
          #filters_panel .dashboard-panel { background-color : #F2F4F5 !important; }
        </style>
      </html>
      <input type="time" id="time_id">
        <label>Time Range</label>
        <default>
          <earliest>-60m@m</earliest>
          <latest>now</latest>
        </default>
        <change>
          <set token="selected_earliest">$earliest$</set>
          <set token="selected_latest">$latest$</set>
        </change>
      </input>
    </panel>
  </row>
  <row>
    <panel id="panel_top_workloads_with_id">
      <title>Top Workloads With</title>
      <input type="dropdown" id="host_action_id" token="host_action">
        <label>Traffic</label>
        <fieldForLabel>label</fieldForLabel>
        <fieldForValue>value</fieldForValue>
        <search>
          <query>| inputlookup illumio_traffic_details_lookup</query>
        </search>
        <default>blocked</default>
      </input>
      <input type="dropdown" id="host_top_id" token="host_top">
        <label>Top</label>
        <fieldForLabel>label</fieldForLabel>
        <fieldForValue>value</fieldForValue>
        <search>
          <query>| inputlookup illumio_top_details_lookup where type="workloads" | table label, value</query>
        </search>
        <default>10</default>
      </input>
      <html>
        <div class="multiselectInput">
          <input id="top_workloads_with_id" placeholder="  Enter Label to filter traffic"/>
          <div id="top_workloads_with_searchdata">Waiting for data...</div>
        </div>
      </html>
      <chart>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as Count first(Illumio.os_name) as "OS Name" from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector $collector_fqdn$ $tstats_leader_fqdn$ $top_workloads_with$ Illumio.action=$host_action$ by Illumio.hostname | eval OS=if(isnull('OS Name') OR 'OS Name'="null","No_OS",'OS Name') | sort - Count | head $host_top$ | lookup illumio_os_details_lookup os_name as OS OUTPUT os_category | rename Illumio.hostname as Hostname | eval os_category=if(isnull(lower(os_category)),OS,os_category) | chart sum(Count) as Count over Hostname by os_category | addtotals fieldname=total | sort -total | fields - total</query>
        </search>
        <drilldown>
          <link target="_blank">search?q=`illumio_get_index` sourcetype="illumio:pce:collector" hostname="$click.value$" $fqdn$ $leader_fqdn$ action=$host_action$&amp;earliest=$selected_earliest$&amp;latest=$selected_latest$</link>
        </drilldown>
        <option name="charting.chart.stackMode">default</option>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.axisTitleY.text">Flow Count</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.fieldColors">{"windows":#5073a5,"linux":0x73A550,"No_OS":0xB0B0B0}</option>
      </chart>
    </panel>
    <panel id="panel_top_services_with_id">
      <title>Top Services With</title>
      <input type="dropdown" id="service_action_id" token="service_action">
        <label>Traffic</label>
        <fieldForLabel>label</fieldForLabel>
        <fieldForValue>value</fieldForValue>
        <search>
          <query>| inputlookup illumio_traffic_details_lookup</query>
        </search>
        <default>blocked</default>
      </input>
      <input type="dropdown" id="service_top_id" token="service_top">
        <label>Top</label>
        <fieldForLabel>label</fieldForLabel>
        <fieldForValue>value</fieldForValue>
        <search>
          <query>| inputlookup illumio_top_details_lookup where type="services" | table label, value</query>
        </search>
        <default>10</default>
      </input>
      <html>
        <div class="multiselectInput">
          <input id="top_services_with_id" placeholder="  Enter Label to filter traffic"/>
          <div id="top_services_with_searchdata">Waiting for data...</div>
        </div>
      </html>
      <chart>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as Count from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector $collector_fqdn$ $tstats_leader_fqdn$ $top_services_with$ Illumio.action=$service_action$ by Illumio.dst_port Illumio.protocol | sort - Count | head $service_top$ | rename Illumio.dst_port as dst_port, Illumio.protocol as protocol | eval Service = dst_port + "/" + protocol | stats sum(Count) as Count by Service | sort - Count</query>
        </search>
        <drilldown>
          <link target="_blank">search?q=`illumio_get_index` sourcetype="illumio:pce:collector" port_protocol="$click.value$" $fqdn$ $leader_fqdn$ action=$service_action$&amp;pce_fqdn=$fqdn$&amp;earliest=$selected_earliest$&amp;latest=$selected_latest$</link>
        </drilldown>
        <option name="charting.chart">bar</option>
        <option name="charting.legend.placement">none</option>
        <option name="charting.chart.showDataLabels">all</option>
        <option name="charting.axisTitleY.text">Flow Count</option>
        <option name="charting.seriesColors">[0x73A550]</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Potentially Blocked Traffic (Traffic that will be blocked when policy is enforced)</title>
      <html>
        <input id="potentially_blocked_label_id" placeholder="  Enter Label to filter traffic"/>
        <div id="potentially_searchdata">Waiting for data...</div>
      </html>
      <chart>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as "potentially-blocked" from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector $collector_fqdn$ $tstats_leader_fqdn$ Illumio.action="potentially-blocked" by _time | timechart span=$span$ sum(potentially-blocked) as potentially-blocked count | eval "Potentially Blocked"=if(count=="0",0,'potentially-blocked') | rename _time as Time  | eval `illumio_get_time(Time)` | table Time,"Potentially Blocked"  $potentially_blocked_label$</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">$potentially_blocked_label_overlay$</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.fieldColors">{"Potentially Blocked":0xe57561}</option>
        <option name="charting.axisTitleY.text">Potentially Blocked</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Blocked Traffic (Traffic not allowed by policy)</title>
      <html>
        <input id="blocked_label_id" placeholder="  Enter Label to filter traffic"/>
        <div id="blocked_searchdata">Waiting for data...</div>
      </html>
      <chart>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as Blocked from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector $collector_fqdn$ $tstats_leader_fqdn$ Illumio.action="blocked" by _time | timechart span=$span$ sum(Blocked) as Blocked count | eval Blocked=if(count=="0",0,Blocked) | rename _time as Time | eval `illumio_get_time(Time)` | table Time,Blocked $blocked_label$</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">$blocked_label_overlay$</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.fieldColors">{"Blocked":0x9185b6}</option>
        <option name="charting.axisTitleY.text">Blocked</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
  <row>
    <panel>
      <title>Total Traffic Flows</title>
      <html>
        <input id="total_label_id" placeholder="  Enter Label to filter traffic"/>
        <div id="total_searchdata">Waiting for data...</div>
      </html>
      <chart>
        <search>
          <query>| tstats `summariesonly` sum(Illumio.count) as Total from datamodel=Illumio where nodename=Illumio.Illumio_PCE_Collector $collector_fqdn$ $tstats_leader_fqdn$ Illumio.action="*" by _time | timechart span=$span$ sum(Total) as Total count | eval Total=if(count=="0",0,Total) | rename _time as Time | eval `illumio_get_time(Time)` | table Time,Total $total_label$</query>
        </search>
        <option name="charting.chart">area</option>
        <option name="charting.chart.overlayFields">$total_label_overlay$</option>
        <option name="charting.chart.nullValueMode">zero</option>
        <option name="charting.legend.placement">bottom</option>
        <option name="charting.axisTitleX.text">Time</option>
        <option name="charting.fieldColors">{"Total":0x70c580}</option>
        <option name="charting.axisTitleY.text">Total</option>
        <option name="charting.drilldown">none</option>
      </chart>
    </panel>
  </row>
</form>